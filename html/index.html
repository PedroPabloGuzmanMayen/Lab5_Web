<!DOCTYPE html>
<html>
    <head>
        <title>Chat</title>
    </head>
    <body>
        <script type="application/javascript">
            const messagesList = document.createElement('ul')
            const getMessages = async () =>{
                const response = await fetch('https://chat.tiburoncin.lat/messages')
                const messages = await response.json()
                messagesList.innerHTML = ''
                messages.forEach(message => {
                    const messageItem = document.createElement('li')
                    messageItem.append(`${message.username}: ${message.message}`)
                    messagesList.append(messageItem)
                })

            }
            const update = async (getFunction, interval) =>{
                const execute = async () =>{
                    await getFunction()
                    setTimeout(execute, interval)
                }
                execute()


            }

            const postMessage = async (username, message) =>{
                const response = await fetch('https://chat.tiburoncin.lat/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: username,
                        message: message
                    })
                })
                const data = await response.json()
                console.log(data)
            }

            let alertCond = false //Esta variable nos ayudará a verificar si el usuario ingreso un nombre de usuario no valido
            // Creación del campo de texto para el nombre de usuario
            const userField = document.createElement('textarea')
            userField.placeholder = 'Ingresa tu nombre de usuario: '
            userField.style.position = 'fixed';
            userField.style.top = '20%'
            userField.style.left = '50%'
            userField.style.transform = 'translateX(-50%)';
            document.body.append(userField)

            // Creación del botón "Continuar"
            const continueButton = document.createElement('button');
            continueButton.append('Continuar')
            continueButton.style.position = 'fixed'
            continueButton.style.top = '30%'
            continueButton.style.left = '50%'
            continueButton.style.transform = 'translateX(-50%)';
            document.body.append(continueButton)

            // Creación del área de mensaje
            const messageArea = document.createElement('textarea')
            messageArea.placeholder = 'Escribe tu mensaje'
            messageArea.style.position = 'fixed'
            messageArea.style.bottom = '70px'
            messageArea.style.left = '50%'
            messageArea.style.transform = 'translateX(-50%)'
            messageArea.style.width = '80%'


            // Creación del botón de enviar mensaje
            const messageButton = document.createElement('button')
            messageButton.append('Enviar');
            messageButton.style.position = 'fixed';
            messageButton.style.bottom = '10px';
            messageButton.style.left = '50%';
            messageButton.style.transform = 'translateX(-50%)';
            messageButton.style.width = '80px';

            // Event listener para el botón "Continuar"
            continueButton.addEventListener('click', () => {

            

                // Verificar si se ingresó un nombre de usuario válido
                if(userField.value === '') {
                    const alert = document.createElement('h1')
                    alert.append('Por favor ingresa un nombre de usuario válido')
                    alert.style.position = 'fixed'
                    alert.style.top = '40%'
                    alert.style.left = '50%'
                    alert.style.transform = 'translateX(-50%)'
                    alert.style.color = 'red'
                    document.body.append(alert)
                    alertCond = true
                }
                else{
                    if (alertCond){
                        document.body.removeChild(document.querySelector('h1'))
                    }
                    //Si el usuario ingresó un nombre valido, eliminamos los campos de registro de usuario y creamos botones pra enviar mensajes
                    
                    document.body.removeChild(userField)
                    document.body.removeChild(continueButton)
                    document.body.append(messageArea)
                    document.body.append(messageButton)
                    document.body.append(messagesList)
                    update(getMessages, 1000)
                    const user = userField.value;
                    

                }

            })

            // Event listener para el botón de enviar mensaje
            messageButton.addEventListener('click', () => {
                const message = messageArea.value;
                const heading = document.createElement('h1')
                heading.append(message)
                document.body.append(heading)

            })

            
            
        </script>
    </body>
</html>
